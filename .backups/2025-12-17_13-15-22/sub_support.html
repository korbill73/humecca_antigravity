<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="view-transition" content="same-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>고객센터 - HUMECCA</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600;700;800&display=block" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css?v=3.20">
    <link rel="stylesheet" href="service_premium.css">
    <style>
        /* Premium Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            width: 90%;
            max-width: 700px;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            animation: modalPop 0.3s ease-out;
        }

        @keyframes modalPop {
            from {
                transform: scale(0.95);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .premium-modal-header {
            background: #1e293b;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .premium-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }

        .premium-close {
            color: rgba(255, 255, 255, 0.7);
            font-size: 28px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .premium-close:hover {
            color: white;
        }

        .premium-modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
            color: #334155;
            line-height: 1.6;
        }

        .premium-modal-body img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Support Hero (Premium) -->
    <main id="main-content">
        <section class="cloud-hero" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);">
            <div class="container">
                <div class="cloud-badgetext"
                    style="background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3);">
                    Customer Support</div>
                <h1>고객센터</h1>
                <p>무엇을 도와드릴까요? 휴메카의 전문 엔지니어가 24시간 대기하고 있습니다.</p>
            </div>
        </section>

        <!-- Quick Contact Info -->
        <section class="support-info-bar">
            <div class="container">
                <div class="support-info-grid">
                    <div class="info-card">
                        <div class="info-icon"><i class="fas fa-headset"></i></div>
                        <div class="info-text">
                            <h3>기술지원 문의</h3>
                            <p>02-418-4442</p>
                            <span>평일 09:00 - 18:00</span>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon" style="background:#f0fdf4; color:#16a34a;"><i
                                class="fas fa-phone-alt"></i>
                        </div>
                        <div class="info-text">
                            <h3>서비스 가입 문의</h3>
                            <p style="color:#16a34a;">02-418-7766</p>
                            <span>평일 09:00 - 18:00</span>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon" style="background:#fef2f2; color:#dc2626;"><i
                                class="fas fa-exclamation-triangle"></i></div>
                        <div class="info-text">
                            <h3>긴급 장애 접수</h3>
                            <p style="color:#dc2626;">02-418-4442</p>
                            <span>24시간 연중무휴</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tabs Content -->
        <section class="section">
            <div class="container">
                <div class="tab-container">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="notice" onclick="switchTab('notice')">공지사항</button>
                        <button class="tab-btn" data-tab="faq" onclick="switchTab('faq')">자주 묻는 질문</button>
                        <button class="tab-btn" data-tab="inquiry" onclick="switchTab('inquiry')">1:1 문의</button>
                    </div>

                    <!-- Tab: Notice -->
                    <div id="notice" class="tab-content active">
                        <div id="notice-list" style="max-width: 900px; margin: 0 auto;">
                            <!-- Loading -->
                            <div id="notice-loading" style="text-align: center; padding: 60px; color: #9ca3af;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 20px;"></i>
                                <p>공지사항을 불러오는 중...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: FAQ -->
                    <div id="faq" class="tab-content">
                        <!-- Category Tabs -->
                        <div id="category-tabs"
                            style="display: flex; gap: 10px; justify-content: center; margin-bottom: 40px; flex-wrap: wrap;">
                            <button class="category-tab active" data-category="all"
                                style="padding: 10px 20px; border: 2px solid #dc2626; background: #dc2626; color: white; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.95rem;">
                                전체
                            </button>
                            <button class="category-tab" data-category="general"
                                style="padding: 10px 20px; border: 2px solid #e5e7eb; background: white; color: #4b5563; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.95rem;">
                                일반
                            </button>
                            <button class="category-tab" data-category="technical"
                                style="padding: 10px 20px; border: 2px solid #e5e7eb; background: white; color: #4b5563; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.95rem;">
                                기술
                            </button>
                            <button class="category-tab" data-category="billing"
                                style="padding: 10px 20px; border: 2px solid #e5e7eb; background: white; color: #4b5563; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.95rem;">
                                요금
                            </button>
                            <button class="category-tab" data-category="service"
                                style="padding: 10px 20px; border: 2px solid #e5e7eb; background: white; color: #4b5563; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 0.95rem;">
                                서비스
                            </button>
                        </div>

                        <div id="faq-list" style="max-width: 900px; margin: 0 auto;">
                            <!-- Loading -->
                            <div id="faq-loading" style="text-align: center; padding: 60px; color: #9ca3af;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 20px;"></i>
                                <p>FAQ를 불러오는 중...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Inquiry -->
                    <div id="inquiry" class="tab-content">
                        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; text-align:center;">1:1 문의
                        </h2>
                        <div style="max-width: 800px; margin: 0 auto;">
                            <div
                                style="background:white; border:1px solid #e2e8f0; border-radius:16px; padding:40px; box-shadow:0 4px 12px rgba(0,0,0,0.05);">
                                <form action="#" method="post" id="contactForm">
                                    <div style="margin-bottom:20px;">
                                        <label
                                            style="display:block; font-weight:600; margin-bottom:8px; color:#334155;">이름
                                            <span style="color:#dc2626;">*</span></label>
                                        <input type="text" name="name" required
                                            style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:6px;">
                                    </div>
                                    <div
                                        style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                                        <div>
                                            <label
                                                style="display:block; font-weight:600; margin-bottom:8px; color:#334155;">연락처
                                                <span style="color:#dc2626;">*</span></label>
                                            <input type="tel" name="phone" required
                                                style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:6px;">
                                        </div>
                                        <div>
                                            <label
                                                style="display:block; font-weight:600; margin-bottom:8px; color:#334155;">이메일
                                                <span style="color:#dc2626;">*</span></label>
                                            <input type="email" name="email" required
                                                style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:6px;">
                                        </div>
                                    </div>
                                    <div style="margin-bottom:20px;">
                                        <label
                                            style="display:block; font-weight:600; margin-bottom:8px; color:#334155;">문의
                                            유형</label>
                                        <select name="type"
                                            style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:6px;">
                                            <option value="tech">기술 지원</option>
                                            <option value="sales">서비스 도입/견적</option>
                                            <option value="billing">요금/청구</option>
                                            <option value="etc">기타</option>
                                        </select>
                                    </div>
                                    <div style="margin-bottom:30px;">
                                        <label
                                            style="display:block; font-weight:600; margin-bottom:8px; color:#334155;">내용
                                            <span style="color:#dc2626;">*</span></label>
                                        <textarea name="message" rows="5" required
                                            style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:6px; resize:vertical;"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary"
                                        style="width:100%; padding:15px; font-weight:700;">문의 접수하기</button>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>
    <script src="components/loader.js?v=3.20"></script>
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase_config.js"></script>

    <script>
        // ==================== State Management ====================
        let noticesLoaded = false;
        let faqsLoaded = false;
        let allFaqs = [];
        let currentFaqCategory = 'all';

        const faqCategoryNames = {
            general: '일반',
            technical: '기술',
            billing: '요금',
            service: '서비스'
        };

        // ==================== Tab Switching ====================
        function switchTab(tabId) {
            // Update UI
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (activeBtn) activeBtn.classList.add('active');

            // Update URL hash
            if (window.location.hash.substring(1) !== tabId) {
                history.pushState(null, null, '#' + tabId);
            }

            // Lazy Load Data
            if (tabId === 'notice' && !noticesLoaded) loadNotices();
            if (tabId === 'faq' && !faqsLoaded) loadFaqs();
        }

        // ==================== Data Loading: Notices ====================
        async function loadNotices() {
            if (!supabase) return;
            noticesLoaded = true;

            try {
                const { data, error } = await supabase
                    .from('notices')
                    .select('*')
                    .eq('active', true)
                    .order('is_pinned', { ascending: false })
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const listContainer = document.getElementById('notice-list');
                const loading = document.getElementById('notice-loading');

                if (loading) loading.style.display = 'none';

                if (!data || data.length === 0) {
                    listContainer.innerHTML = '<p style="text-align:center; color:#9ca3af; padding:60px;">등록된 공지사항이 없습니다.</p>';
                    return;
                }

                // Clear existing (except loading if needed, though we hid it)
                listContainer.innerHTML = '';

                data.forEach(notice => {
                    const date = new Date(notice.created_at).toLocaleDateString('ko-KR');
                    const div = document.createElement('div');

                    // Card Styling & Interaction
                    div.style.cssText = `
                        background: white; padding: 30px; margin-bottom: 20px; border-radius: 12px;
                        border-left: 4px solid ${notice.is_pinned ? '#dc2626' : '#3b82f6'};
                        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.3s ease;
                        cursor: pointer; position: relative;
                    `;

                    // Hover Effects
                    div.onmouseover = function () { this.style.transform = 'translateY(-5px)'; this.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)'; };
                    div.onmouseout = function () { this.style.transform = 'translateY(0)'; this.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.05)'; };

                    // Click Handler
                    div.onclick = () => openNoticeModal(notice);

                    // Content Preview (Strip HTML)
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = notice.content;
                    let plainText = tempDiv.textContent || tempDiv.innerText || "";
                    if (plainText.length > 120) plainText = plainText.substring(0, 120) + "...";

                    div.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                ${notice.is_pinned ? '<span style="background: #dc2626; color: white; padding: 4px 12px; border-radius: 4px; font-size: 0.85rem; margin-right: 10px; font-weight:700;">공지</span>' : ''}
                                <h3 style="font-size: 1.35rem; font-weight: 700; color: #1e293b; display: inline;">${notice.title}</h3>
                            </div>
                            <div style="color: #94a3b8; font-size: 0.9rem; white-space: nowrap;">
                                <i class="far fa-calendar-alt"></i> ${date}
                            </div>
                        </div>
                        <p style="color: #64748b; line-height: 1.6; margin-bottom: 20px; font-size: 1rem;">${plainText}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #f1f5f9; padding-top: 15px;">
                            <span style="color: #64748b; font-size: 0.9rem;"><i class="fas fa-user-circle"></i> ${notice.author || '관리자'}</span>
                            <span style="color: #3b82f6; font-size: 0.95rem; font-weight: 600;">자세히 보기 <i class="fas fa-arrow-right" style="font-size:0.85rem; margin-left:4px;"></i></span>
                        </div>
                    `;
                    listContainer.appendChild(div);
                });

            } catch (error) {
                console.error('Notice Load Error:', error);
            }
        }

        // ==================== Data Loading: FAQs ====================
        async function loadFaqs() {
            if (!supabase) return;
            faqsLoaded = true;

            try {
                const { data, error } = await supabase
                    .from('faqs')
                    .select('*')
                    .eq('active', true)
                    .order('category', { ascending: true })
                    .order('sort_order', { ascending: true });

                if (error) throw error;

                const loading = document.getElementById('faq-loading');
                if (loading) loading.style.display = 'none';

                allFaqs = data || [];
                renderFaqs();

            } catch (error) {
                console.error('FAQ Load Error:', error);
            }
        }

        function renderFaqs() {
            const listContainer = document.getElementById('faq-list');
            listContainer.innerHTML = '';

            const filtered = currentFaqCategory === 'all'
                ? allFaqs
                : allFaqs.filter(f => f.category === currentFaqCategory);

            if (filtered.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 60px;">해당 카테고리에 FAQ가 없습니다.</p>';
                return;
            }

            const grouped = {};
            filtered.forEach(f => {
                if (!grouped[f.category]) grouped[f.category] = [];
                grouped[f.category].push(f);
            });

            Object.keys(grouped).forEach(cat => {
                if (currentFaqCategory === 'all') {
                    const h3 = document.createElement('h3');
                    h3.textContent = faqCategoryNames[cat] || cat;
                    h3.style.cssText = 'font-size: 1.5rem; font-weight: 700; color: #111827; margin: 40px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #dc2626;';
                    listContainer.appendChild(h3);
                }

                grouped[cat].forEach(faq => {
                    const el = document.createElement('div');
                    el.className = 'faq-item';
                    el.innerHTML = `
                         <div class="faq-header" onclick="this.parentElement.classList.toggle('active')">
                            <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                                <span style="background: #3b82f6; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">Q</span>
                                <h4 style="font-size: 1.1rem; font-weight: 600; color: #111827; margin: 0;">${faq.question}</h4>
                            </div>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-body">
                            <div style="display: flex; gap: 15px;">
                                <span style="background: #dc2626; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">A</span>
                                <div style="color: #4b5563; line-height: 1.8; flex: 1;">${faq.answer}</div>
                            </div>
                        </div>
                    `;
                    listContainer.appendChild(el);
                });
            });
        }

        // ==================== Initialize ====================
        window.addEventListener('load', () => {
            // FAQ Category Click
            document.querySelectorAll('.category-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-tab').forEach(b => {
                        b.classList.remove('active');
                        b.style.background = 'white';
                        b.style.color = '#4b5563';
                        b.style.borderColor = '#e5e7eb';
                    });
                    btn.classList.add('active');
                    btn.style.background = '#dc2626';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#dc2626';

                    currentFaqCategory = btn.dataset.category;
                    renderFaqs();
                });
            });

            // Hash handling
            const hash = window.location.hash.substring(1);
            if (hash && ['notice', 'faq', 'inquiry'].includes(hash)) {
                switchTab(hash);
            } else {
                // Default to notice if no hash (or just 1st tab)
                // Although 'notice' is active by default in HTML, we ensure data loads:
                switchTab('notice');
            }
        });
    </script>

    <script src="js/subpage-canvas.js"></script>
    <script src="js/navigation.js"></script>

    <script>
        // ==================== Contact Form Handler ====================
        document.getElementById('contactForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerText;
            submitBtn.disabled = true;
            submitBtn.innerText = '접수 중...';

            const formData = new FormData(e.target);

            // Map type code to friendly text for the Subject column
            const typeMap = {
                'tech': '기술 지원 문의',
                'sales': '서비스 도입/견적 문의',
                'billing': '요금/청구 문의',
                'etc': '기타 문의'
            };
            const typeVal = formData.get('type');
            const subjectText = typeMap[typeVal] || '일반 문의';

            const payload = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                email: formData.get('email'),
                subject: subjectText, // Map to 'subject' column
                message: formData.get('message'),
                status: 'new' // Default status
            };

            try {
                if (!supabase) throw new Error('Supabase client not initialized');

                // 1. Save to Supabase
                const { error } = await supabase.from('inquiries').insert([payload]);
                if (error) throw error;

                // 2. Optional: Send Email Notification (if EmailJS is ready)
                if (window.emailjs && window.EMAIL_PUBLIC_KEY) {
                    try {
                        await emailjs.send('default_service', 'template_inquiry', {
                            from_name: payload.name,
                            from_email: payload.email,
                            phone: payload.phone,
                            type: subjectText, // Use friendly name for email too
                            message: payload.message
                        });
                    } catch (emailErr) {
                        console.warn('Email sending failed, but DB saved:', emailErr);
                    }
                }

                alert('문의가 접수되었습니다. 담당자가 확인 후 연락드리겠습니다.');
                e.target.reset();

            } catch (err) {
                console.error('Inquiry Error:', err);
                alert('접수 중 오류가 발생했습니다: ' + err.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = originalText;
            }
        });
    </script>
    <!-- Notice Detail Modal -->
    <div id="notice-modal" class="modal">
        <div class="modal-content">
            <div class="premium-modal-header">
                <h3 class="premium-modal-title" id="modal-notice-title">공지사항 상세</h3>
                <span class="premium-close" onclick="closeNoticeModal()">&times;</span>
            </div>
            <div class="premium-modal-body">
                <div
                    style="border-bottom:1px solid #e2e8f0; padding-bottom:15px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span id="modal-notice-date" style="color:#64748b; font-size:0.9rem; margin-right:15px;"><i
                                class="far fa-calendar-alt"></i> </span>
                        <span id="modal-notice-author" style="color:#64748b; font-size:0.9rem;"><i
                                class="fas fa-user-circle"></i> </span>
                    </div>
                </div>
                <div id="modal-notice-content" style="min-height:100px;"></div>
            </div>
        </div>
    </div>

    <script>
        // Modal Logic
        function openNoticeModal(notice) {
            const modal = document.getElementById('notice-modal');
            document.getElementById('modal-notice-title').innerText = notice.title;
            document.getElementById('modal-notice-date').innerHTML = '<i class="far fa-calendar-alt"></i> ' + new Date(notice.created_at).toLocaleDateString('ko-KR');
            document.getElementById('modal-notice-author').innerHTML = '<i class="fas fa-user-circle"></i> ' + (notice.author || '관리자');
            document.getElementById('modal-notice-content').innerHTML = notice.content;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeNoticeModal() {
            document.getElementById('notice-modal').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        // Close on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('notice-modal');
            if (event.target == modal) {
                closeNoticeModal();
            }
        }
    </script>
</body>

</html>
```
